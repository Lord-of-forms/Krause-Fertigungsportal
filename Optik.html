<!DOCTYPE html>
<html>
<head>
    <title>Optik - Fertigungsportal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.4/css/bulma.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        /* Grundlegende Stile */
        .info-window {
            padding-top: 10px;
        }
        textarea {
            overflow-y: auto;
            resize: none;
            width: 100%;
            height: 150px;
            box-sizing: border-box;
        }
        h1, h2, h3 {
            font-weight: bold;
        }

        /* Stile für Datum und Uhrzeit */
        .date-time-container {
            position: fixed;
            top: 50px;
            right: 100px;
            background-color: #ffffff;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }

        .date-time-container #date {
            display: block;
            font-size: 20px;
            font-weight: normal;
            color: #000;
        }

        .date-time-container #time {
            display: block;
            font-size: 22px;
            font-weight: bold;
            color: #000;
        }

        /* Stile für Untertitel */
        .subtitle {
            margin-top: 0.5rem;
            margin-bottom: 0.25rem;
        }

        /* Stile für den Abstand zwischen den Abschnitten */
        .section {
            margin-bottom: 1rem;
        }

        /* Stile für den oberen Abstand */
        .top-margin {
            margin-top: 0.5rem;
        }

        /* Stile für die Buttons */
        .button-link {
            margin-bottom: 0.5rem;
        }

        /* Stil für die einzelnen Info-Container */
        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        /* Stil für die Checkboxen */
        .info-checkbox {
            margin-right: 10px;
        }

        /* Stil für den Text der Information */
        .info-text {
            flex-grow: 1;
        }

        /* Stil für die abwechselnde Zeilenfärbung */
        .info-item:nth-child(odd) {
            background-color: #ffffff;
        }

        .info-item:nth-child(even) {
            background-color: #f2f2f2;
        }

        /* Stile für den Frame */
        .frame {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100%;
            background-color: #f4f4f4;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(12, 0, 0, 0.336);
        }

        .frame h3 {
            margin-bottom: 20px;
        }

        .frame a {
            display: block;
            margin-bottom: 10px;
            color: #0c0b0b;
        }

        #visitCount {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 10px;
            color: #666;
            background: rgba(255, 255, 255, 0.7);
            padding: 2px 5px;
            border-radius: 3px;
        }

        /* Stile für die Statistiken */
        .statistics {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 12px;
            color: #666;
            background: rgba(255, 255, 255, 0.7);
            padding: 5px 10px;
            border-radius: 3px;
        }

        .statistics p {
            display: none;
        }

        .statistics button {
            font-size: 12px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0;
        }

        .statistics button::before {
            content: "SL";
            display: inline-block;
            position: relative;
            top: -15px;
        }
    </style>
</head>
<body>
    <div class="frame">
        <h3>Wichtige Links</h3>
        <a href="https://www.krause.de" title="Homepage Krause.">Krause Home</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/ankuendigungen.html" title="Aktuelle Nachrichten, Veranstaltungen und wichtige Termine.">Ankündigungen und Mitteilungen</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/interne_ressourcen.html" title="Zugriff auf Handbücher, Richtlinien und mehr.">Interne Ressourcen und Dokumente</a>
        <a href="file:///hg-srv-040.hg.intern\Telefonlisten" title="Kontaktinformationen / Telefonlisten">Kontaktinformationen</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/kalender_veranstaltungen.html" title="Interne Kalender mit geplanten Veranstaltungen.">Kalender und Veranstaltungen</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/urlaubsplanung.html" title="Urlaubsplanung Antrag und Übersichtstabelle.">Urlaubsplanung</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/leistungen_vorteile.html" title="Informationen über Mitarbeiterleistungen und Vergünstigungen.">Leistungen und Vorteile</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/externe_ressourcen.html" title="Links zu externen Websites und Ressourcen.">Hallenplan / Lagerorte</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/schulungen_weiterbildung.html" title="Interne und externe Schulungsprogramme.">Schulungs- und Weiterbildungsmöglichkeiten</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/feedback_umfragen.html" title="Feedback geben, an Umfragen teilnehmen.">Feedback und Umfragen</a>
        <a href="https://www.krause.de/unternehmen/stellenanzeigen" title="Aktuelle Stellen bei Krause.">Stellenangebote</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/Schwarzes Brett.html" title="Biete Suche.">Schwarzes Brett</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/Schwarzes Brett.html" title="Kantine.">Kantine</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/Betriebsvereinbahrungen.html" title="Betriebsvereinbahrungen.">Betriebsvereinbahrungen</a>
        <a href="https://krause-biagosch.hinweisgeber-biehn.de/" title="Regelverstöße und Gesetzesverletzungen melden.">Hinweisgebermeldestelle</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/Optik.html" title="Wareneingang.">Wareneingang</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/Optik.html" title="Inbetriebnahme.">Inbetriebnahme</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/Optik.html" title="Optik Daten.">Optik</a>
        <a href="file:///U:/Montage/Optik/Fertigungsportal/Krause%20Intranet.htm" title="Montage.">Montage</a>
    </div>

    <section class="section" style="margin-left: 250px;">
        <div class="container">
            <h1 class="title">Optik - Fertigungsportal</h1>
            <div class="date-time-container">
                <span id="date"></span>
                <span id="time"></span>

                <!-- Besucherzähler-HTML -->
                <div id="visitCount">BZähl: <span id="counter"></span></div>
            </div>

            <h2 class="subtitle top-margin">Materialanforderung Zentrallager</h2>
            <button class="button is-link button-link" id="btn1" data-name="Materialentnahme Zentrallager" style="background-color: #008080;" onclick="trackButtonClick('btn1'); openInNewTab('https://script.google.com/macros/s/AKfycbyTO0ufbXkvavbAP3EIG9HXAatykWD0N79e8LI0Zrza6eHrqg_4v8wND4PKpVQL7R4/exec')">Materialentnahme Zentrallager</button>
            <button class="button is-link button-link" id="btn2" data-name="Materialentnahme Zentrallager Tabelle" style="background-color: #618b8b;" onclick="trackButtonClick('btn2'); openInNewTab('https://docs.google.com/spreadsheets/d/1eK3qGUsnfFIWL5KpVG6KK2RWsSpwhgGS016zJkjOOKE/edit#gid=0')">Materialentnahme Zentrallager Tabelle</button>
            <button class="button is-link button-link" id="btn3" data-name="Gebrauchsanweisung Materialentnahme Zentrallager" style="background-color: #618b8b;" onclick="trackButtonClick('btn3'); openInNewTab('https://docs.google.com/document/d/1KptbXbopBimtGxGs6cswQ7dtFdqgGn3m6SuKVzIqAao/edit')">Gebrauchsanweisung Materialentnahme Zentrallager</button>
            <h2 class="subtitle">Optikbau Formulare und Dokumente</h2>
            <button class="button is-link button-link" id="btn4" data-name="Optik Datenbank Eingabeformular" style="background-color: #f835f8;" onclick="trackButtonClick('btn4'); openInNewTab('https://forms.gle/jtqeDTPoS5smn4vL9')">Optik Datenbank Eingabeformular </button>
            <button class="button is-link button-link" id="btn5" data-name="Optik Datenbank Tabelle" style="background-color: #804d80;" onclick="trackButtonClick('btn5'); openInNewTab('https://docs.google.com/spreadsheets/d/1O82rBAm-9o6NyzxyVUPiP54dDm3YNUU44aoCKOzIGYw/edit?usp=sharing')">Optik Datenbank Tabelle</button>
            <h2 class="subtitle">KVP Formulare</h2>
            <button class="button is-link button-link" id="btn6" data-name="Formular zur Erfassung von Fehlern" style="background-color: #f5c366;" onclick="trackButtonClick('btn6'); openInNewTab('https://forms.gle/a9793NW9njXSgPnq9')">Formular zur Erfassung von Fehlern, Verbesserungsvorschlägen, Qualitätsmeldungen, Prozessverbesserungen und mehr</button>
            <br>
            <button class="button is-link button-link" id="btn7" data-name="Baugruppenanpassung" style="background-color: #808080;" onclick="trackButtonClick('btn7'); openInNewTab('https://docs.google.com/forms/d/e/1FAIpQLSepdY5Itpdb8y3aIZNm3rb7Q8Szpm6iIL0f3BqWfSjrcO_E9Q/viewform')">Baugruppenanpassung</button>
            <button class="button is-link button-link" id="btn8" data-name="Gefahrstoffe" style="background-color: #cc5353;" onclick="trackButtonClick('btn8'); openFolder('U:/Montage/Optik/Fertigungsportal/Gefahrstoffe.html')">Gefahrstoffe</button>
            <button class="button is-link button-link" id="btn9" data-name="Telefonlisten / Mitarbeiterliste" style="background-color: #5f5aa1;" onclick="trackButtonClick('btn9'); openFolder('U:/Montage/Optik/Fertigungsportal/Telefonlisten.html')">Telefonlisten / Mitarbeiterliste</button>
            <button class="button is-link button-link" id="btn10" data-name="Lieferplan" style="background-color: #569751;" onclick="trackButtonClick('btn10'); openFolder('U:/Montage/Optik/Fertigungsportal/Lieferplan.html')">Lieferplan</button>
            <button class="button is-link button-link" id="btn11" data-name="Produktionsverfolgung Dashboard" style="background-color: #4a86e8;" onclick="trackButtonClick('btn11'); openInNewTab('https://script.google.com/macros/s/AKfycbwZwAV0rb5omco00lgrChXz_kCLEXSI0SaBLthj6uLF/dev')">Produktionsverfolgung Antriebe Dashboard</button>
            <div id="app-content" class="info-window">
            
                <!-- Der Inhalt wird hier dynamisch geladen -->
            </div>

            <!-- Anzeige der Statistik -->
            <div class="statistics">
                <button onclick="downloadExcel()"></button>
            </div>
        </div>
    </section>

    <script>
        let isUserActive = false;
        let sessionStartTime = Date.now();

        document.addEventListener('input', function() {
            isUserActive = true;
        });

        setInterval(function() {
            if (!isUserActive) {
                var iframe = document.getElementById('myIframe');
                iframe.src = iframe.src; // Aktualisiert das Iframe
            }
            isUserActive = false; // Zurücksetzen des Aktivitätsstatus
        }, 60000); // Intervall von 10 Sekunden

        function loadAppContent() {
    const appUrl = 'https://script.google.com/macros/s/AKfycbzTaNMTnozouVy7X2EvcY46Apt5zZzomLVjHdBmm3zUNE-Qu1Gx1ONz3qUYYyYfsP2o_A/exec';
    
    fetch(appUrl)
        .then(response => response.text())
        .then(data => {
            document.getElementById('app-content').innerHTML = data;
        })
        .catch(error => {
            console.error('Error loading app content:', error);
            document.getElementById('app-content').innerHTML = 'Fehler beim Laden des Inhalts. Bitte versuchen Sie es später erneut.';
        });
}


function updateDateTime() {
    const now = new Date();
    const optionsDate = { dateStyle: 'medium' };
    const optionsTime = { timeStyle: 'medium', hour12: false };
    const formattedDate = now.toLocaleDateString('de-DE', optionsDate);
    const formattedTime = now.toLocaleTimeString('de-DE', optionsTime);
    document.getElementById('date').textContent = formattedDate;
    document.getElementById('time').textContent = formattedTime;
}


        function updateVisitCount() {
            const counter = document.getElementById('counter');
            let visitCount = localStorage.getItem('visitCount');
            if (!visitCount) {
                visitCount = 0;
            }
            visitCount = parseInt(visitCount) + 1;
            localStorage.setItem('visitCount', visitCount);
            counter.textContent = visitCount;
        }

        function updateStatistics() {
            const totalVisits = localStorage.getItem('visitCount');
            const totalDuration = localStorage.getItem('totalVisitDuration');
            const avgVisitDuration = totalVisits && totalDuration ? (totalDuration / totalVisits).toFixed(2) : 0;

            document.getElementById('visitCountTotal').textContent = totalVisits;
            document.getElementById('avgVisitDuration').textContent = avgVisitDuration;
        }

        window.addEventListener('beforeunload', function() {
            const sessionEndTime = Date.now();
            const sessionDuration = (sessionEndTime - sessionStartTime) / 1000; // in Sekunden
            let totalDuration = localStorage.getItem('totalVisitDuration');
            totalDuration = totalDuration ? parseFloat(totalDuration) : 0;
            totalDuration += sessionDuration;
            localStorage.setItem('totalVisitDuration', totalDuration);
        });

        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            updateVisitCount(); // Aufruf der Funktion zum Besucherzählen beim Laden der Seite
            updateStatistics(); // Statistik aktualisieren
        });

        function autoResize() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const textarea = document.querySelector('textarea');
            textarea.addEventListener('input', autoResize);

            const savedInfo = localStorage.getItem('currentInfo');
            if (savedInfo) {
                textarea.value = savedInfo;
                autoResize.call(textarea);
            }

            textarea.addEventListener('input', function() {
                localStorage.setItem('currentInfo', this.value);
            });
        });

        function openInNewTab(url) {
            window.open(url, '_blank');
        }

        function openFolder(folderPath) {
            window.open("file:///" + folderPath.replace(/\\/g, '/'));
        }

        // Funktion zur Verfolgung der Button-Klicks
        function trackButtonClick(buttonId) {
            const button = document.getElementById(buttonId);
            const buttonName = button.getAttribute('data-name').substring(0, 20); // Maximal 20 Zeichen
            const date = new Date().toISOString().split('T')[0]; // Datum im Format YYYY-MM-DD

            // Daten aus dem localStorage abrufen oder initialisieren
            let clickData = JSON.parse(localStorage.getItem('clickData')) || {};
            if (!clickData[date]) {
                clickData[date] = {};
            }
            if (!clickData[date][buttonName]) {
                clickData[date][buttonName] = 0;
            }

            // Klickzähler erhöhen
            clickData[date][buttonName] += 1;
            localStorage.setItem('clickData', JSON.stringify(clickData));
        }

        // Funktion zum Erstellen und Herunterladen der Excel-Datei
        function downloadExcel() {
            const clickData = JSON.parse(localStorage.getItem('clickData')) || {};
            const today = new Date();
            const rows = [['Button Name', 'Anzahl Klicks Heute', 'Anzahl Klicks Diese Woche', 'Anzahl Klicks Diesen Monat', 'Anzahl Klicks Dieses Jahr']];

            // Hilfsfunktionen
            const getStartOfWeek = date => {
                const startOfWeek = new Date(date);
                const day = startOfWeek.getDay();
                const diff = startOfWeek.getDate() - day + (day === 0 ? -6 : 1);
                return new Date(startOfWeek.setDate(diff));
            };

            const getStartOfMonth = date => {
                return new Date(date.getFullYear(), date.getMonth(), 1);
            };

            const getStartOfYear = date => {
                return new Date(date.getFullYear(), 0, 1);
            };

            const formatDate = date => {
                return date.toISOString().split('T')[0];
            };

            // Berechnung der Klicks
            const calculateClicks = (startDate, endDate, buttonName) => {
                let totalClicks = 0;
                for (const date in clickData) {
                    const currentDate = new Date(date);
                    if (currentDate >= startDate && currentDate <= endDate && clickData[date][buttonName]) {
                        totalClicks += clickData[date][buttonName];
                    }
                }
                return totalClicks;
            };

            const buttonNames = new Set();
            for (const date in clickData) {
                for (const buttonName in clickData[date]) {
                    buttonNames.add(buttonName);
                }
            }

            buttonNames.forEach(buttonName => {
                const todayClicks = calculateClicks(today, today, buttonName);
                const weekClicks = calculateClicks(getStartOfWeek(today), today, buttonName);
                const monthClicks = calculateClicks(getStartOfMonth(today), today, buttonName);
                const yearClicks = calculateClicks(getStartOfYear(today), today, buttonName);

                rows.push([buttonName, todayClicks, weekClicks, monthClicks, yearClicks]);
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(rows);
            XLSX.utils.book_append_sheet(wb, ws, "Click Data");

            XLSX.writeFile(wb, "click_data.xlsx");
        }

        document.addEventListener('DOMContentLoaded', loadAppContent);

        function loadAppContent() {
    const appUrl = 'https://script.google.com/macros/s/AKfycbzbquIbkFs2E08MLVy085okesbsFB8hXNC7GCkYbdapZ7gw3ERIGkFfPMc8au-at67qWQ/exec';
    
    console.log('Versuche, Inhalt zu laden von:', appUrl);
    
    fetch(appUrl)
        .then(response => {
            console.log('Antwort erhalten:', response);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.text();
        })
        .then(data => {
            console.log('Daten erfolgreich geladen:', data.substring(0, 100) + '...'); // Zeigt die ersten 100 Zeichen
            document.getElementById('app-content').innerHTML = data;
        })
        .catch(error => {
            console.error('Fehler beim Laden des App-Inhalts:', error);
            document.getElementById('app-content').innerHTML = 'Fehler beim Laden des Inhalts. Bitte versuchen Sie es später erneut. Fehler: ' + error.message;
        });
}
    </script>
</body>
</html>
